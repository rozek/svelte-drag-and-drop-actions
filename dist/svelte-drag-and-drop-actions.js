!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("javascript-interface-library"),require("svelte-coordinate-conversion")):"function"==typeof define&&define.amd?define(["exports","javascript-interface-library","svelte-coordinate-conversion"],r):(e="undefined"!=typeof globalThis?globalThis:e||self,function(){var n=e.DragAndDropActions,o=e.DragAndDropActions={};r(o,e.JIL,e.Conversion),o.noConflict=function(){return e.DragAndDropActions=n,o}}())}(this,(function(e,r,n){"use strict";function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var t=o(n),a="__DragAndDropActions"in r.global?r.global.__DragAndDropActions:r.global.__DragAndDropActions={};function l(e){var n,o,t,a,l,i,s,d,c,u,p,f,m;switch(n=(e=r.allowedPlainObject("drag options",e)||{}).Extras,!0){case null==e.relativeTo:o="parent";break;case"parent"===e.relativeTo:case"body"===e.relativeTo:case r.ValueIsNonEmptyString(e.relativeTo):case e.relativeTo instanceof HTMLElement:case e.relativeTo instanceof SVGElement:o=e.relativeTo;break;default:r.throwError("InvalidArgument: invalid position reference given")}switch(t=r.allowedNonEmptyString('"onlyFrom" CSS selector',e.onlyFrom),a=r.allowedNonEmptyString('"neverFrom" CSS selector',e.neverFrom),!0){case null==e.Dummy:l=void 0;break;case"standard"===e.Dummy:case"none"===e.Dummy:case r.ValueIsNonEmptyString(e.Dummy):case e.Dummy instanceof HTMLElement:case e.Dummy instanceof SVGElement:case r.ValueIsFunction(e.Dummy):l=e.Dummy;break;default:r.throwError("InvalidArgument: invalid drag dummy specification given")}if(i=r.allowedFiniteNumber("dummy x offset",e.DummyOffsetX),s=r.allowedFiniteNumber("dummy y offset",e.DummyOffsetY),null==(d=r.allowedFiniteNumber("min. x position",e.minX))&&(d=-1/0),null==(c=r.allowedFiniteNumber("min. y position",e.minY))&&(c=-1/0),null==(u=r.allowedFiniteNumber("max. x position",e.maxX))&&(u=1/0),null==(p=r.allowedFiniteNumber("max. y position",e.maxY))&&(p=1/0),m=e.onDragStart,r.ValueIsPlainObject(m)&&r.ValueIsFiniteNumber(m.x)&&r.ValueIsFiniteNumber(m.y)){var D=e.onDragStart,v=D.x,y=D.y;f=function(){return{x:v,y:y}}}else f=r.allowedFunction('"onDragStart" handler',e.onDragStart);return{Extras:n,relativeTo:o,onlyFrom:t,neverFrom:a,Dummy:l,DummyOffsetX:i,DummyOffsetY:s,minX:d,minY:c,maxX:u,maxY:p,onDragStart:f,onDragMove:r.allowedFunction('"onDragMove" handler',e.onDragMove),onDragEnd:r.allowedFunction('"onDragEnd" handler',e.onDragEnd),onDragCancel:undefined}}function i(e,r,n){if(null!=r.onlyFrom||null!=r.neverFrom){var o,t=n.clientX,a=n.clientY,l=document.elementFromPoint(t,a);if(l=s(l,t,a),null!=r.onlyFrom)if(e!==(o=l.closest(r.onlyFrom))&&!e.contains(o))return!0;if(null!=r.neverFrom)if(e===(o=l.closest(r.neverFrom))||e.contains(o))return!0}return!1}function s(e,r,n){for(var o=e.children,a=0,l=o.length;a<l;a++){var i=o[a],d=t.default.fromLocalTo("viewport",{left:0,top:0},i);if(!(r<d.left||n<d.top)&&!(r>d.left+i.offsetWidth-1||n>d.top+i.offsetHeight-1))return s(i,r,n)}return e}var d=["copy","move","link"];function c(e){var n,o;return n=D("list of allowed operations",(e=r.allowedPlainObject("drop options",e)||{}).Operations,"copy"),"none"in(o=Object.assign({},r.allowedPlainObject("data to be offered",e.DataToOffer)))&&r.throwError('InvalidArgument: "none" is not a valid data type'),{Operations:n,DataToOffer:o,onDropZoneEnter:r.allowedFunction('"onDropZoneEnter" handler',e.onDropZoneEnter),onDropZoneHover:r.allowedFunction('"onDropZoneHover" handler',e.onDropZoneHover),onDropZoneLeave:r.allowedFunction('"onDropZoneLeave" handler',e.onDropZoneLeave),onDropped:r.allowedFunction('"onDropped" handler',e.onDropped)}}function u(e){var n,o;for(var t in n=(e=r.allowedPlainObject("drop zone options",e)||{}).Extras,r.allowPlainObject("data types to be accepted",e.TypesToAccept),o=Object.create(null),null!=e.TypesToAccept&&"none"in e.TypesToAccept&&r.throwError('InvalidArgument: "none" is not a valid data type'),e.TypesToAccept)e.TypesToAccept.hasOwnProperty(t)&&(o[t]=D("list of accepted operations for type "+r.quoted(t),e.TypesToAccept[t]));return{Extras:n,TypesToAccept:o,HoldDelay:r.allowedIntegerInRange("min. time to hold",e.HoldDelay,0),onDroppableEnter:r.allowedFunction('"onDroppableEnter" handler',e.onDroppableEnter),onDroppableMove:r.allowedFunction('"onDroppableMove" handler',e.onDroppableMove),onDroppableLeave:r.allowedFunction('"onDroppableLeave" handler',e.onDroppableLeave),onDroppableHold:r.allowedFunction('"onDroppableHold" handler',e.onDroppableHold),onDroppableRelease:r.allowedFunction('"onDroppableRelease" handler',e.onDroppableRelease),onDrop:r.allowedFunction('"onDrop" handler',e.onDrop)}}function p(e){return{x:e.left,y:e.top}}function f(e,n){var o;switch(!0){case"parent"===n.relativeTo:o=e.parentElement;break;case"body"===n.relativeTo:o=document.body;break;case n.relativeTo instanceof HTMLElement:case n.relativeTo instanceof SVGElement:(o=n.relativeTo)==document.body||document.body.contains(o)||r.throwError('InvalidArgument: the HTML element given as "relativeTo" option is not part of this HTML document');break;default:o=e.closest(n.relativeTo)}return null==o?document.body:o}function m(e,n){switch(!0){case"standard"===n.Dummy:return;case"none"===n.Dummy:var o=document.createElement("div");return o.setAttribute("style","display:block; position:absolute; width:1px; height:1px; background:transparent; border:none; margin:0px; padding:0px; cursor:auto"),document.body.appendChild(o),o;case r.ValueIsNonEmptyString(n.Dummy):var t=document.createElement("div");return t.style.display="block",t.style.position="absolute",t.style.left=document.body.scrollWidth+100+"px",document.body.appendChild(t),t.innerHTML=n.Dummy,t.children[0];case n.Dummy instanceof HTMLElement:case n.Dummy instanceof SVGElement:return n.Dummy;case r.ValueIsFunction(n.Dummy):var a=void 0;try{a=n.Dummy(n.Extras,e)}catch(e){console.error("RuntimeError: creating draggable dummy failed",e)}if(null!=a){if(a instanceof HTMLElement||a instanceof SVGElement)return a;console.error("InvalidArgument: the newly created draggable dummy is neither an HTML nor an SVG element")}}}function D(e,n,o){void 0===o&&(o="copy move link");var t=r.allowedString(e,n)||o;switch(t.trim()){case"all":return"copy move link";case"none":return""}var a=t.trim().replace(/\s+/g," ").split(" ");return r.allowListSatisfying(e,a,(function(e){return r.ValueIsOneOf(e,d)})),a.reduce((function(e,r){return e.indexOf(r)<0?e+r+" ":e})," ")}function v(e,n){for(var o=[],t=2;t<arguments.length;t++)o[t-2]=arguments[t];if(null!=n[e])try{return n[e].apply(null,o)}catch(n){console.error(r.quoted(e)+" handler failed",n)}}var y=v;e.DropOperations=d,e.asDraggable=function(e,n){var o,a,s,d,c,u,p,D,y;return o=!1,a=l(n),e.setAttribute("draggable","true"),e.addEventListener("dragstart",(function(n){var l=a;if(i(e,l,n))return n.stopPropagation(),n.preventDefault(),!1;s=f(e,l);var v=t.default.fromDocumentTo("local",{left:n.pageX,top:n.pageY},s);if(d=c=0,D={x:0,y:0},null==l.onDragStart)D={x:0,y:0};else try{var g=l.onDragStart(l.Extras);if(r.ValueIsPlainObject(g)){var T=r.allowedFiniteNumber("x start position",g.x),E=r.allowedFiniteNumber("y start position",g.y);d=T-v.left,c=E-v.top,T=r.constrained(T,l.minX,l.maxX),E=r.constrained(E,l.minY,l.maxY),D={x:T,y:E}}}catch(e){console.error('"onDragStart" handler failed',e)}if(y=D,u=!1,null==l.Dummy&&(l.Dummy="none"),null!=(p=m(e,l))&&null!=n.dataTransfer){var x=l.DummyOffsetX,b=l.DummyOffsetY;if(null==x||null==b){var h=t.default.fromDocumentTo("local",{left:n.pageX,top:n.pageY},e);null==x&&(x=h.left),null==b&&(b=h.top)}switch(!0){case"none"===l.Dummy:n.dataTransfer.setDragImage(p,0,0),setTimeout((function(){document.body.removeChild(p)}),0);break;case r.ValueIsString(l.Dummy):n.dataTransfer.setDragImage(p,x,b),setTimeout((function(){document.body.removeChild(p.parentElement)}),0);break;default:n.dataTransfer.setDragImage(p,x,b)}}null!=n.dataTransfer&&(n.dataTransfer.effectAllowed="none"),o=!0,setTimeout((function(){return e.classList.add("dragged")}),0),n.stopPropagation()})),e.addEventListener("drag",(function(e){if(!o)return!1;var n=a;if(0!==e.screenX||0!==e.screenY||u){u=!1;var l=t.default.fromDocumentTo("local",{left:e.pageX,top:e.pageY},s),i=l.left+d,p=l.top+c;i=r.constrained(i,n.minX,n.maxX),p=r.constrained(p,n.minY,n.maxY);var f=i-y.x,m=p-y.y;y={x:i,y:p},v("onDragMove",n,i,p,f,m,n.Extras)}else u=!0;e.stopPropagation()})),e.addEventListener("dragend",(function(n){if(!o)return!1;var t=a;if(null!=t.onDragEnd){var l=r.constrained(y.x,t.minX,t.maxX),i=r.constrained(y.y,t.minY,t.maxY);v("onDragEnd",t,l,i,l-y.x,i-y.y,t.Extras)}o=!1,e.classList.remove("dragged"),n.stopPropagation()})),{update:function(e){e=l(e),null==a.Extras&&null!=e.Extras&&(a.Extras=e.Extras),a.Dummy=e.Dummy||a.Dummy,a.minX=e.minX,a.minY=e.minY,a.maxX=e.maxX,a.maxY=e.maxY,a.onDragStart=e.onDragStart||a.onDragStart}}},e.asDropZone=function(e,n){var o;return o=u(n),e.setAttribute("draggable","true"),e.addEventListener("dragenter",(function(r){if(null!=r.dataTransfer&&"none"!==r.dataTransfer.effectAllowed){var n=o,l=r.dataTransfer.dropEffect;if("none"===l)switch(r.dataTransfer.effectAllowed){case"copy":case"move":case"link":l=r.dataTransfer.effectAllowed;break;default:l=void 0}var i=n.TypesToAccept,s=r.dataTransfer.types.filter((function(e){return e in i&&""!==i[e]}));if(0!==s.length){var d=p(t.default.fromDocumentTo("local",{left:r.pageX,top:r.pageY},e));!1!==y("onDroppableEnter",n,d.x,d.y,l,s,a.currentDroppableExtras,n.Extras)&&(a.currentDropZoneExtras=n.Extras,a.currentDropZoneElement=e,a.currentDropZonePosition=d,e.classList.add("hovered"),r.preventDefault(),r.stopPropagation())}}})),e.addEventListener("dragover",(function(r){if(null==r.dataTransfer||"none"===r.dataTransfer.effectAllowed||null!=a.currentDropZoneElement&&a.currentDropZoneElement!==e)e.classList.remove("hovered");else{var n=o,l=r.dataTransfer.dropEffect;if("none"===l)switch(r.dataTransfer.effectAllowed){case"copy":case"move":case"link":l=r.dataTransfer.effectAllowed;break;default:l=void 0}var i=n.TypesToAccept,s=r.dataTransfer.types.filter((function(e){return e in i&&""!==i[e]}));if(0===s.length)return a.currentDropZoneElement===e&&(a.currentDropZoneExtras=void 0,a.currentDropZoneElement=void 0,a.currentDropZonePosition=void 0),void e.classList.remove("hovered");if(a.currentDropZonePosition=p(t.default.fromDocumentTo("local",{left:r.pageX,top:r.pageY},e)),!1!==y("onDroppableMove",n,a.currentDropZonePosition.x,a.currentDropZonePosition.y,l,s,a.currentDroppableExtras,n.Extras))return a.currentDropZoneExtras=n.Extras,a.currentDropZoneElement=e,e.classList.add("hovered"),r.preventDefault(),!1;a.currentDropZoneExtras=void 0,a.currentDropZoneElement=void 0,a.currentDropZonePosition=void 0,e.classList.remove("hovered")}})),e.addEventListener("dragleave",(function(r){e.classList.remove("hovered");var n=o;a.currentDropZoneElement===e&&(null==a.currentTypeTransferred&&(a.currentDropZoneExtras=void 0,a.currentDropZoneElement=void 0,a.DroppableWasDropped=!1,a.currentDropZonePosition=void 0,a.currentTypeTransferred=void 0,a.currentDataTransferred=void 0,v("onDroppableLeave",n,a.currentDroppableExtras,n.Extras)),r.preventDefault(),r.stopPropagation())})),e.addEventListener("drop",(function(n){if(e.classList.remove("hovered"),null!=n.dataTransfer&&"none"!==n.dataTransfer.effectAllowed&&a.currentDropZoneElement===e){n.stopPropagation();var l=o,i=n.dataTransfer.dropEffect;if("none"===i)switch(n.dataTransfer.effectAllowed){case"copy":case"move":case"link":i=n.dataTransfer.effectAllowed;break;default:i=void 0}var s=l.TypesToAccept,d=n.dataTransfer.types.filter((function(e){return e in s&&(null==i||s[e].indexOf(i)>=0)}));if(0===d.length)return a.currentDropZoneExtras=void 0,a.currentDropZonePosition=void 0,a.DroppableWasDropped=!1,a.currentDropOperation=void 0,a.currentTypeTransferred=void 0,a.currentDataTransferred=void 0,void v("onDroppableLeave",l,a.currentDroppableExtras,l.Extras);a.currentDropZonePosition=p(t.default.fromDocumentTo("local",{left:n.pageX,top:n.pageY},e));var c={};d.forEach((function(e){return c[e]=n.dataTransfer.getData(e)}));var u=y("onDrop",l,a.currentDropZonePosition.x,a.currentDropZonePosition.y,i,c,a.currentDroppableExtras,l.Extras);switch(!0){case null==u:a.DroppableWasDropped=!0,a.currentDropOperation=i,a.currentTypeTransferred=void 0,a.currentDataTransferred=void 0;break;case r.ValueIsOneOf(u,d):a.DroppableWasDropped=!0,a.currentDropOperation=i,a.currentTypeTransferred=u,a.currentDataTransferred=c[u];break;default:a.DroppableWasDropped=!1,a.currentDropZoneExtras=void 0,a.currentDropZonePosition=void 0,a.currentDropOperation=void 0,a.currentTypeTransferred=void 0,a.currentDataTransferred=void 0}a.currentDropZoneElement=void 0}})),{update:function(e){null!=(e=u(e)).Extras&&(o.Extras=e.Extras),r.ObjectIsNotEmpty(e.TypesToAccept)&&(o.TypesToAccept=e.TypesToAccept),null!=e.HoldDelay&&(o.HoldDelay=e.HoldDelay)}}},e.asDroppable=function(e,n){var o,s,d,u,p,D,y,g,T,E,x,b;return o=!1,s=l(n),d=c(n),e.setAttribute("draggable","true"),e.addEventListener("dragstart",(function(n){var l=Object.assign({},s,d);if(i(e,l,n))return n.stopPropagation(),n.preventDefault(),!1;u=f(e,l);var c,v=t.default.fromDocumentTo("local",{left:n.pageX,top:n.pageY},u);if(p=D=0,T={x:0,y:0},null==l.onDragStart)T={x:0,y:0};else try{var h=l.onDragStart(l.Extras);if(r.ValueIsPlainObject(h)){var w=r.allowedFiniteNumber("x start position",h.x),Z=r.allowedFiniteNumber("y start position",h.y);p=w-v.left,D=Z-v.top,w=r.constrained(w,l.minX,l.maxX),Z=r.constrained(Z,l.minY,l.maxY),T={x:w,y:Z}}}catch(e){console.error('"onDragStart" handler failed',e)}if(E=T,x=void 0,b=void 0,y=!1,null==l.Dummy&&(l.Dummy="standard"),null!=(g=m(e,l))&&null!=n.dataTransfer){var O=l.DummyOffsetX,A=l.DummyOffsetY;if(null==O||null==A){var L=t.default.fromDocumentTo("local",{left:n.pageX,top:n.pageY},e);null==O&&(O=L.left),null==A&&(A=L.top)}switch(!0){case"none"===l.Dummy:n.dataTransfer.setDragImage(g,0,0),setTimeout((function(){document.body.removeChild(g)}),0);break;case r.ValueIsString(l.Dummy):n.dataTransfer.setDragImage(g,O,A),setTimeout((function(){document.body.removeChild(g.parentElement)}),0);break;default:n.dataTransfer.setDragImage(g,O,A)}}if(null!=n.dataTransfer){var P=["none","copy","link","copyLink","move","copyMove","linkMove","all"][2*(2*((c=l.Operations).indexOf("move")<0?0:1)+(c.indexOf("link")<0?0:1))+(c.indexOf("copy")<0?0:1)];if(n.dataTransfer.effectAllowed=P,r.ObjectIsNotEmpty(l.DataToOffer))for(var F in l.DataToOffer)l.DataToOffer.hasOwnProperty(F)&&n.dataTransfer.setData(F,l.DataToOffer[F])}a.currentDroppableExtras=l.Extras,a.currentDropZoneExtras=void 0,a.currentDropZonePosition=void 0,a.DroppableWasDropped=!1,a.currentDropOperation=void 0,a.currentTypeTransferred=void 0,a.currentDataTransferred=void 0,o=!0,setTimeout((function(){return e.classList.add("dragged")}),0),n.stopPropagation()})),e.addEventListener("drag",(function(n){if(!o)return!1;var l=Object.assign({},s,d);if(0!==n.screenX||0!==n.screenY||y){y=!1;var i=t.default.fromDocumentTo("local",{left:n.pageX,top:n.pageY},u),c=i.left+p,f=i.top+D;c=r.constrained(c,l.minX,l.maxX),f=r.constrained(f,l.minY,l.maxY);var m=c-E.x,g=f-E.y;E={x:c,y:f},v("onDragMove",l,c,f,m,g,l.Extras)}else y=!0;a.currentDropZoneElement===x?null!=a.currentDropZoneElement&&v("onDropZoneHover",l,a.currentDropZonePosition.x,a.currentDropZonePosition.y,a.currentDropZoneExtras,l.Extras):(null==a.currentDropZoneElement?(e.classList.remove("droppable"),v("onDropZoneLeave",l,b,l.Extras)):(e.classList.add("droppable"),v("onDropZoneEnter",l,a.currentDropZonePosition.x,a.currentDropZonePosition.y,b,l.Extras)),x=a.currentDropZoneElement,b=a.currentDropZoneExtras),n.stopPropagation()})),e.addEventListener("dragend",(function(n){if(!o)return!1;var t=Object.assign({},s,d);if(a.DroppableWasDropped&&(v("onDropped",t,a.currentDropZonePosition.x,a.currentDropZonePosition.y,a.currentDropOperation,a.currentTypeTransferred,a.currentDataTransferred,a.currentDropZoneExtras,t.Extras),a.currentDropZoneExtras=void 0,a.currentDropZonePosition=void 0,a.DroppableWasDropped=!1,a.currentDropOperation=void 0,a.currentTypeTransferred=void 0,a.currentDataTransferred=void 0),null!=t.onDragEnd){var l=r.constrained(E.x,t.minX,t.maxX),i=r.constrained(E.y,t.minY,t.maxY);v("onDragEnd",t,l,i,l-E.x,i-E.y,t.Extras)}a.currentDroppableExtras=void 0,o=!1,e.classList.remove("dragged","droppable"),n.stopPropagation()})),{update:function(e){!function(e){e=l(e),null==s.Extras&&null!=e.Extras&&(s.Extras=e.Extras),s.Dummy=e.Dummy||s.Dummy,s.minX=e.minX,s.minY=e.minY,s.maxX=e.maxX,s.maxY=e.maxY,s.onDragStart=e.onDragStart||s.onDragStart}(e),function(e){e=c(e),d.Operations=e.Operations,d.DataToOffer=e.DataToOffer}(e)}}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=svelte-drag-and-drop-actions.js.map
