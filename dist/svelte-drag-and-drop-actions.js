!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("javascript-interface-library"),require("svelte-coordinate-conversion")):"function"==typeof define&&define.amd?define(["exports","javascript-interface-library","svelte-coordinate-conversion"],n):(e="undefined"!=typeof globalThis?globalThis:e||self,function(){var a=e.DragAndDropActions,t=e.DragAndDropActions={};n(t,e.JIL,e.Conversion),t.noConflict=function(){return e.DragAndDropActions=a,t}}())}(this,(function(e,n,a){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o,r,l,i,d,s,c,u,f=t(a);function m(e){var a,t,o,r,l,i,d,s,c,u,f,m,p;switch(a=(e=n.allowedPlainObject("drag options",e)||{}).Extras,!0){case null==e.relativeTo:t="parent";break;case"parent"===e.relativeTo:case"body"===e.relativeTo:case n.ValueIsNonEmptyString(e.relativeTo):case e.relativeTo instanceof HTMLElement:case e.relativeTo instanceof SVGElement:t=e.relativeTo;break;default:n.throwError("InvalidArgument: invalid position reference given")}switch(o=n.allowedNonEmptyString('"onlyFrom" CSS selector',e.onlyFrom),r=n.allowedNonEmptyString('"neverFrom" CSS selector',e.neverFrom),!0){case null==e.Dummy:l=void 0;break;case"standard"===e.Dummy:case"none"===e.Dummy:case n.ValueIsNonEmptyString(e.Dummy):case e.Dummy instanceof HTMLElement:case e.Dummy instanceof SVGElement:case n.ValueIsFunction(e.Dummy):l=e.Dummy;break;default:n.throwError("InvalidArgument: invalid drag dummy specification given")}if(i=n.allowedFiniteNumber("dummy x offset",e.DummyOffsetX),d=n.allowedFiniteNumber("dummy y offset",e.DummyOffsetY),null==(s=n.allowedFiniteNumber("min. x position",e.minX))&&(s=-1/0),null==(c=n.allowedFiniteNumber("min. y position",e.minY))&&(c=-1/0),null==(u=n.allowedFiniteNumber("max. x position",e.maxX))&&(u=1/0),null==(f=n.allowedFiniteNumber("max. y position",e.maxY))&&(f=1/0),p=e.onDragStart,n.ValueIsPlainObject(p)&&n.ValueIsFiniteNumber(p.x)&&n.ValueIsFiniteNumber(p.y)){var v=e.onDragStart,y=v.x,D=v.y;m=function(){return{x:y,y:D}}}else m=n.allowedFunction('"onDragStart" handler',e.onDragStart);return{Extras:a,relativeTo:t,onlyFrom:o,neverFrom:r,Dummy:l,DummyOffsetX:i,DummyOffsetY:d,minX:s,minY:c,maxX:u,maxY:f,onDragStart:m,onDragMove:n.allowedFunction('"onDragMove" handler',e.onDragMove),onDragEnd:n.allowedFunction('"onDragEnd" handler',e.onDragEnd),onDragCancel:undefined}}function p(e,n,a){if(null!=n.onlyFrom||null!=n.neverFrom){var t,o=a.clientX,r=a.clientY,l=document.elementFromPoint(o,r);if(l=v(l,o,r),null!=n.onlyFrom)if(e!==(t=l.closest(n.onlyFrom))&&!e.contains(t))return!0;if(null!=n.neverFrom)if(e===(t=l.closest(n.neverFrom))||e.contains(t))return!0}return!1}function v(e,n,a){for(var t=e.children,o=0,r=t.length;o<r;o++){var l=t[o],i=f.default.fromLocalTo("viewport",{left:0,top:0},l);if(!(n<i.left||a<i.top)&&!(n>i.left+l.offsetWidth-1||a>i.top+l.offsetHeight-1))return v(l,n,a)}return e}var y=["copy","move","link"];function D(e){var a,t;return a=E("list of allowed operations",(e=n.allowedPlainObject("drop options",e)||{}).Operations,"copy"),"none"in(t=Object.assign({},n.allowedPlainObject("data to be offered",e.DataToOffer)))&&n.throwError('InvalidArgument: "none" is not a valid data type'),{Operations:a,DataToOffer:t,onDropZoneEnter:n.allowedFunction('"onDropZoneEnter" handler',e.onDropZoneEnter),onDropZoneHover:n.allowedFunction('"onDropZoneHover" handler',e.onDropZoneHover),onDropZoneLeave:n.allowedFunction('"onDropZoneLeave" handler',e.onDropZoneLeave),onDropped:n.allowedFunction('"onDropped" handler',e.onDropped)}}function g(e){var a,t;for(var o in a=(e=n.allowedPlainObject("drop zone options",e)||{}).Extras,n.allowPlainObject("data types to be accepted",e.TypesToAccept),t=Object.create(null),"none"in e.TypesToAccept&&n.throwError('InvalidArgument: "none" is not a valid data type'),e.TypesToAccept)e.TypesToAccept.hasOwnProperty(o)&&(t[o]=E("list of accepted operations for type "+n.quoted(o),e.TypesToAccept[o]));return{Extras:a,TypesToAccept:t,HoldDelay:n.allowedIntegerInRange("min. time to hold",e.HoldDelay,0),onDroppableEnter:n.allowedFunction('"onDroppableEnter" handler',e.onDroppableEnter),onDroppableMove:n.allowedFunction('"onDroppableMove" handler',e.onDroppableMove),onDroppableLeave:n.allowedFunction('"onDroppableLeave" handler',e.onDroppableLeave),onDroppableHold:n.allowedFunction('"onDroppableHold" handler',e.onDroppableHold),onDroppableRelease:n.allowedFunction('"onDroppableRelease" handler',e.onDroppableRelease),onDrop:n.allowedFunction('"onDrop" handler',e.onDrop)}}function T(e){return{x:e.left,y:e.top}}function b(e,a){var t;switch(!0){case"parent"===a.relativeTo:t=e.parentElement;break;case"body"===a.relativeTo:t=document.body;break;case a.relativeTo instanceof HTMLElement:case a.relativeTo instanceof SVGElement:(t=a.relativeTo)==document.body||document.body.contains(t)||n.throwError('InvalidArgument: the HTML element given as "relativeTo" option is not part of this HTML document');break;default:t=e.closest(a.relativeTo)}return null==t?document.body:t}function x(e,a){switch(!0){case"standard"===a.Dummy:return;case"none"===a.Dummy:var t=document.createElement("div");return t.setAttribute("style","display:block; position:absolute; width:1px; height:1px; background:transparent; border:none; margin:0px; padding:0px; cursor:auto"),document.body.appendChild(t),t;case n.ValueIsNonEmptyString(a.Dummy):var o=document.createElement("div");return o.style.display="block",o.style.position="absolute",o.style.left=document.body.scrollWidth+100+"px",document.body.appendChild(o),o.innerHTML=a.Dummy,o.children[0];case a.Dummy instanceof HTMLElement:case a.Dummy instanceof SVGElement:return a.Dummy;case n.ValueIsFunction(a.Dummy):var r=void 0;try{r=a.Dummy(a.Extras,e)}catch(e){console.error("RuntimeError: creating draggable dummy failed",e)}if(null!=r){if(r instanceof HTMLElement||r instanceof SVGElement)return r;console.error("InvalidArgument: the newly created draggable dummy is neither an HTML nor an SVG element")}}}function E(e,a,t){void 0===t&&(t="copy move link");var o=n.allowedString(e,a)||t;switch(o.trim()){case"all":return"copy move link";case"none":return""}var r=o.trim().replace(/\s+/g," ").split(" ");return n.allowListSatisfying(e,r,(function(e){return n.ValueIsOneOf(e,y)})),r.reduce((function(e,n){return e.indexOf(n)<0?e+n+" ":e})," ")}function h(e,a){for(var t=[],o=2;o<arguments.length;o++)t[o-2]=arguments[o];if(null!=a[e])try{return a[e].apply(null,t)}catch(a){console.error(n.quoted(e)+" handler failed",a)}}var w=h;e.DropOperations=y,e.asDraggable=function(e,a){var t,o,r,l,i,d,s,c,u;return t=!1,o=m(a),e.setAttribute("draggable","true"),e.addEventListener("dragstart",(function(a){var m=o;if(p(e,m,a))return a.stopPropagation(),a.preventDefault(),!1;r=b(e,m);var v=f.default.fromDocumentTo("local",{left:a.pageX,top:a.pageY},r);if(l=i=0,c={x:0,y:0},null==m.onDragStart)c={x:0,y:0};else try{var y=m.onDragStart(m.Extras);if(n.ValueIsPlainObject(y)){var D=n.allowedFiniteNumber("x start position",y.x),g=n.allowedFiniteNumber("y start position",y.y);l=D-v.left,i=g-v.top,D=n.constrained(D,m.minX,m.maxX),g=n.constrained(g,m.minY,m.maxY),c={x:D,y:g}}}catch(e){console.error('"onDragStart" handler failed',e)}if(u=c,d=!1,null==m.Dummy&&(m.Dummy="none"),null!=(s=x(e,m))&&null!=a.dataTransfer){var T=m.DummyOffsetX,E=m.DummyOffsetY;if(null==T||null==E){var h=f.default.fromDocumentTo("local",{left:a.pageX,top:a.pageY},e);null==T&&(T=h.left),null==E&&(E=h.top)}switch(!0){case"none"===m.Dummy:a.dataTransfer.setDragImage(s,0,0),setTimeout((function(){document.body.removeChild(s)}),0);break;case n.ValueIsString(m.Dummy):a.dataTransfer.setDragImage(s,T,E),setTimeout((function(){document.body.removeChild(s.parentElement)}),0);break;default:a.dataTransfer.setDragImage(s,T,E)}}null!=a.dataTransfer&&(a.dataTransfer.effectAllowed="none"),t=!0,setTimeout((function(){return e.classList.add("dragged")}),0),a.stopPropagation()})),e.addEventListener("drag",(function(e){if(!t)return!1;var a=o;if(0!==e.screenX||0!==e.screenY||d){d=!1;var s=f.default.fromDocumentTo("local",{left:e.pageX,top:e.pageY},r),c=s.left+l,m=s.top+i;c=n.constrained(c,a.minX,a.maxX),m=n.constrained(m,a.minY,a.maxY);var p=c-u.x,v=m-u.y;u={x:c,y:m},h("onDragMove",a,c,m,p,v,a.Extras)}else d=!0;e.stopPropagation()})),e.addEventListener("dragend",(function(a){if(!t)return!1;var r=o;if(null!=r.onDragEnd){var l=n.constrained(u.x,r.minX,r.maxX),i=n.constrained(u.y,r.minY,r.maxY);h("onDragEnd",r,l,i,l-u.x,i-u.y,r.Extras)}t=!1,e.classList.remove("dragged"),a.stopPropagation()})),{update:function(e){e=m(e),o.Dummy=e.Dummy||o.Dummy,o.minX=e.minX,o.minY=e.minY,o.maxX=e.maxX,o.maxY=e.maxY,o.onDragStart=e.onDragStart||o.onDragStart}}},e.asDropZone=function(e,a){var t;return t=g(a),e.setAttribute("draggable","true"),e.addEventListener("dragenter",(function(n){if(null!=n.dataTransfer&&"none"!==n.dataTransfer.effectAllowed){var a=t,i=n.dataTransfer.dropEffect;if("none"===i)switch(n.dataTransfer.effectAllowed){case"copy":case"move":case"link":i=n.dataTransfer.effectAllowed;break;default:i=void 0}var s=a.TypesToAccept,c=n.dataTransfer.types.filter((function(e){return e in s&&""!==s[e]}));if(0!==c.length){var u=T(f.default.fromDocumentTo("local",{left:n.pageX,top:n.pageY},e));!1!==w("onDroppableEnter",a,u.x,u.y,i,c,o,a.Extras)&&(r=a.Extras,l=e,d=u,e.classList.add("hovered"),n.preventDefault(),n.stopPropagation())}}})),e.addEventListener("dragover",(function(n){if(null==n.dataTransfer||"none"===n.dataTransfer.effectAllowed||null!=l&&l!==e)e.classList.remove("hovered");else{var a=t,i=n.dataTransfer.dropEffect;if("none"===i)switch(n.dataTransfer.effectAllowed){case"copy":case"move":case"link":i=n.dataTransfer.effectAllowed;break;default:i=void 0}var s=a.TypesToAccept,c=n.dataTransfer.types.filter((function(e){return e in s&&""!==s[e]}));if(0===c.length)return l===e&&(r=void 0,l=void 0,d=void 0),void e.classList.remove("hovered");if(d=T(f.default.fromDocumentTo("local",{left:n.pageX,top:n.pageY},e)),!1!==w("onDroppableMove",a,d.x,d.y,i,c,o,a.Extras))return r=a.Extras,l=e,e.classList.add("hovered"),n.preventDefault(),!1;r=void 0,l=void 0,d=void 0,e.classList.remove("hovered")}})),e.addEventListener("dragleave",(function(n){e.classList.remove("hovered"),l===e&&(null==c&&(r=void 0,l=void 0,i=!1,d=void 0,c=void 0,u=void 0,h("onDroppableLeave",t,o,t.Extras)),n.preventDefault(),n.stopPropagation())})),e.addEventListener("drop",(function(a){if(e.classList.remove("hovered"),null!=a.dataTransfer&&"none"!==a.dataTransfer.effectAllowed&&l===e){a.stopPropagation();var m=t,p=a.dataTransfer.dropEffect;if("none"===p)switch(a.dataTransfer.effectAllowed){case"copy":case"move":case"link":p=a.dataTransfer.effectAllowed;break;default:p=void 0}var v=m.TypesToAccept,y=a.dataTransfer.types.filter((function(e){return e in v&&(null==p||v[e].indexOf(p)>=0)}));if(0===y.length)return r=void 0,d=void 0,i=!1,s=void 0,c=void 0,u=void 0,void h("onDroppableLeave",m,o,m.Extras);d=T(f.default.fromDocumentTo("local",{left:a.pageX,top:a.pageY},e));var D={};y.forEach((function(e){return D[e]=a.dataTransfer.getData(e)}));var g=w("onDrop",m,d.x,d.y,p,D,o,m.Extras);switch(!0){case null==g:i=!0,s=p,c=void 0,u=void 0;break;case n.ValueIsOneOf(g,y):i=!0,s=p,c=g,u=D[g];break;default:i=!1,r=void 0,d=void 0,s=void 0,c=void 0,u=void 0}l=void 0}})),{update:function(e){null!=(e=g(e)).Extras&&(t.Extras=e.Extras),n.ObjectIsNotEmpty(e.TypesToAccept)&&(t.TypesToAccept=e.TypesToAccept),null!=e.HoldDelay&&(t.HoldDelay=e.HoldDelay)}}},e.asDroppable=function(e,a){var t,v,y,g,T,E,w,O,L,F,X,Y;return t=!1,v=m(a),y=D(a),e.setAttribute("draggable","true"),e.addEventListener("dragstart",(function(a){var l=Object.assign({},v,y);if(p(e,l,a))return a.stopPropagation(),a.preventDefault(),!1;g=b(e,l);var m,D=f.default.fromDocumentTo("local",{left:a.pageX,top:a.pageY},g);if(T=E=0,L={x:0,y:0},null==l.onDragStart)L={x:0,y:0};else try{var h=l.onDragStart(l.Extras);if(n.ValueIsPlainObject(h)){var A=n.allowedFiniteNumber("x start position",h.x),S=n.allowedFiniteNumber("y start position",h.y);T=A-D.left,E=S-D.top,A=n.constrained(A,l.minX,l.maxX),S=n.constrained(S,l.minY,l.maxY),L={x:A,y:S}}}catch(e){console.error('"onDragStart" handler failed',e)}if(F=L,X=void 0,Y=void 0,w=!1,null==l.Dummy&&(l.Dummy="standard"),null!=(O=x(e,l))&&null!=a.dataTransfer){var I=l.DummyOffsetX,k=l.DummyOffsetY;if(null==I||null==k){var P=f.default.fromDocumentTo("local",{left:a.pageX,top:a.pageY},e);null==I&&(I=P.left),null==k&&(k=P.top)}switch(!0){case"none"===l.Dummy:a.dataTransfer.setDragImage(O,0,0),setTimeout((function(){document.body.removeChild(O)}),0);break;case n.ValueIsString(l.Dummy):a.dataTransfer.setDragImage(O,I,k),setTimeout((function(){document.body.removeChild(O.parentElement)}),0);break;default:a.dataTransfer.setDragImage(O,I,k)}}if(null!=a.dataTransfer){var H=["none","copy","link","copyLink","move","copyMove","linkMove","all"][2*(2*((m=l.Operations).indexOf("move")<0?0:1)+(m.indexOf("link")<0?0:1))+(m.indexOf("copy")<0?0:1)];if(a.dataTransfer.effectAllowed=H,n.ObjectIsNotEmpty(l.DataToOffer))for(var M in l.DataToOffer)l.DataToOffer.hasOwnProperty(M)&&a.dataTransfer.setData(M,l.DataToOffer[M])}o=l.Extras,r=void 0,d=void 0,i=!1,s=void 0,c=void 0,u=void 0,t=!0,setTimeout((function(){return e.classList.add("dragged")}),0),a.stopPropagation()})),e.addEventListener("drag",(function(a){if(!t)return!1;var o=Object.assign({},v,y);if(0!==a.screenX||0!==a.screenY||w){w=!1;var i=f.default.fromDocumentTo("local",{left:a.pageX,top:a.pageY},g),s=i.left+T,c=i.top+E;s=n.constrained(s,o.minX,o.maxX),c=n.constrained(c,o.minY,o.maxY);var u=s-F.x,m=c-F.y;F={x:s,y:c},h("onDragMove",o,s,c,u,m,o.Extras)}else w=!0;l===X?null!=l&&h("onDropZoneHover",o,d.x,d.y,r,o.Extras):(null==l?(e.classList.remove("droppable"),h("onDropZoneLeave",o,Y,o.Extras)):(e.classList.add("droppable"),h("onDropZoneEnter",o,d.x,d.y,Y,o.Extras)),X=l,Y=r),a.stopPropagation()})),e.addEventListener("dragend",(function(a){if(!t)return!1;var l=Object.assign({},v,y);if(i&&(h("onDropped",l,d.x,d.y,s,c,u,r,l.Extras),r=void 0,d=void 0,i=!1,s=void 0,c=void 0,u=void 0),null!=l.onDragEnd){var f=n.constrained(F.x,l.minX,l.maxX),m=n.constrained(F.y,l.minY,l.maxY);h("onDragEnd",l,f,m,f-F.x,m-F.y,l.Extras)}o=void 0,t=!1,e.classList.remove("dragged","droppable"),a.stopPropagation()})),{update:function(e){!function(e){e=m(e),v.Dummy=e.Dummy||v.Dummy,v.minX=e.minX,v.minY=e.minY,v.maxX=e.maxX,v.maxY=e.maxY,v.onDragStart=e.onDragStart||v.onDragStart}(e),function(e){e=D(e),y.Operations=e.Operations,y.DataToOffer=e.DataToOffer}(e)}}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=svelte-drag-and-drop-actions.js.map
